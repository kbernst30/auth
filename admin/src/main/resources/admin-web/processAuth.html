<!-- This JS is temporary test logic that will be cleaned up and added to a JS adapter in the future -->
<html>
    <body>
        <div id="error"></div>
        <script type="text/javascript">
            (function() {
                // Get token from URI fragment and refresh parent page
                // The fragment starts with a hash so cut that off
                var uriFragment = window.location.hash && window.location.hash.substring(1),
                    fragmentPieces = uriFragment.split('&'),
                    uriQuery = window.location.search && window.location.search.substring(1),
                    queryParamsArray = uriQuery.split('&');

                var tokenResponse = {};
                for (var i = 0; i < fragmentPieces.length; i++) {
                    var piece = fragmentPieces[i].split('=');
                    if (piece.length === 2) {
                        tokenResponse[piece[0]] = piece[1];
                    }
                }

                var queryParams = {};
                for (var i = 0; i < queryParamsArray.length; i++) {
                    var piece = queryParamsArray[i].split('=');
                    if (piece.length === 2) {
                        queryParams[piece[0]] = piece[1];
                    }
                }

                if (tokenResponse["error"]) {
                    document.getElementById("error").innerHTML = decodeURIComponent(tokenResponse["error"]) + " - " +
                        decodeURIComponent(tokenResponse["error_description"]);

                } else if (queryParams["error"]) {
                    document.getElementById("error").innerHTML = decodeURIComponent(queryParams["error"]) + " - " +
                        decodeURIComponent(queryParams["error_description"]);

                } else {
                    if (tokenResponse['access_token']) {
                        localStorage.setItem("at", decodeURIComponent(tokenResponse['access_token']));
                    }

                    if (tokenResponse["id_token"]) {
                        localStorage.setItem("idt", decodeURIComponent(tokenResponse["id_token"]));
                    }

                    if (queryParams['refresh'] && queryParams['refresh'] !== 'false') {
                        window.top.location.reload();
                    } else {
                        window.top.location.href = "/index.html";
                    }
                }
            }());
        </script>
    </body>
</html>